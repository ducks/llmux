order = 7
what = "CLI commands (run/validate/doctor), output handlers (console/json), progress display"
why = "User-facing layer that wraps all internal functionality; comes last since it depends on everything"
how = "1. CLI framework (clap):\n   - llmux run <workflow> [args...] [dir]\n   - llmux validate <workflow>\n   - llmux doctor [dir]\n   - llmux backends\n   - llmux teams\n   - llmux workflows\n   - llmux context [dir]\n   - Global flags: --team, --context, --output, --debug, --quiet\n\n2. Run command:\n   - Load workflow by name\n   - Auto-detect team (or use --team)\n   - Parse workflow args from CLI\n   - Execute via workflow_engine\n   - Display results via output handler\n\n3. Doctor command:\n   - Check each backend: spawn with --version or simple prompt\n   - Verify team detection works\n   - Report missing dependencies\n   - Color-coded status: ✓ green, ✗ red, ⚠ yellow\n\n4. Output handlers:\n   - ConsoleHandler: pretty terminal output with colors, spinners\n   - JsonHandler: structured JSON to stdout (for piping)\n   - LogHandler: write to .llmux/logs/\n   - TraceHandler: full reasoning traces for debugging\n\n5. Progress display:\n   - Step-by-step progress: [1/5] fetch... ✓ (2.1s)\n   - Parallel step indicator: analyze (parallel: codex, claude)...\n   - Error display: stderr, suggestions, retry status\n   - Use indicatif for spinners/progress bars\n\n6. Debug mode (--debug):\n   - Full trace output: timing, prompts, responses\n   - Write to both console and log file\n   - Include template context at each step\n\n7. Signal handling:\n   - Catch SIGINT (Ctrl+C)\n   - Graceful shutdown: cancel running backends\n   - Save partial state for potential resume\n"
backup = "Minimal CLI (run only) with println! output; add fancy output handlers later"

[context]
inputs = "CLI arguments, workflow engine results, config"
outputs = "Exit code (0 success, 1 failure), formatted output (console/json/log)"
dependencies = ["workflow_engine", "apply_and_verify"]
tests = "1. CLI parsing tests: all commands parse correctly, args validated\n2. Test run command: workflow executes, output displayed\n3. Test validate command: valid workflow passes, invalid errors\n4. Test doctor command: backend checks run, status reported\n5. Test output handlers: console formatting, JSON structure\n6. Test debug mode: extra output included\n7. Test error display: helpful messages, exit codes\n8. Integration test: run CLI binary with real workflow\n"
